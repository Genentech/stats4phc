<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Predictiveness curve, PPV, NPV and 1-NPV risk estimates"><title>Risk profile plot — riskProfile • stats4phc</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Risk profile plot — riskProfile"><meta property="og:description" content="Predictiveness curve, PPV, NPV and 1-NPV risk estimates"><meta property="og:image" content="https://genentech.github.io/stats4phc/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">stats4phc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/stats4phc.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-reports">Reports</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-reports">
    <a class="dropdown-item" href="../coverage-report/">Coverage report</a>
    <a class="dropdown-item" href="../unit-test-report/">Unit test report</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://www.github.com/genentech/stats4phc">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Risk profile plot</h1>
      
      <div class="d-none name"><code>riskProfile.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Predictiveness curve, PPV, NPV and 1-NPV risk estimates</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">riskProfile</span><span class="op">(</span></span>
<span>  <span class="va">outcome</span>,</span>
<span>  <span class="va">score</span>,</span>
<span>  methods <span class="op">=</span> <span class="st">"asis"</span>,</span>
<span>  prev.adj <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  show.prev <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  show.nonparam.pv <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  show.best.pv <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  include <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PC"</span>, <span class="st">"PPV"</span>, <span class="st">"1-NPV"</span><span class="op">)</span>,</span>
<span>  plot.raw <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  rev.order <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>outcome</dt>
<dd><p>Vector of binary outcome for each observation.</p></dd>


<dt>score</dt>
<dd><p>Numeric vector of continuous predicted risk score.</p></dd>


<dt>methods</dt>
<dd><p>Character vector of method names (case-insensitive) for plotting curves or
a named list where elements are method function and its arguments.
Default is set to <code>"asis"</code>.</p>
<p>Full options are: <code>c("asis", "binned", "pava", "mspline", "gam", "cgam")</code>.</p>
<p>To specify arguments per method, use lists. For example:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="at">pava =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"pava"</span>, <span class="at">ties =</span> <span class="st">"primary"</span>),</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="at">mspline =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"mspline"</span>, <span class="at">fitonPerc =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  <span class="at">gam =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"gam"</span>, <span class="at">bs =</span> <span class="st">"tp"</span>, <span class="at">logscores =</span> <span class="cn">FALSE</span>),</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="at">bin =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"binned"</span>, <span class="at">bins =</span> <span class="dv">10</span>),</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="at">risk =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"asis"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>)</span></code></pre><p></p></div>
<p>See section "Estimation" for more details.</p></dd>


<dt>prev.adj</dt>
<dd><p><code>NULL</code> (default) or scalar numeric between 0 and 1 for prevalence adjustment.</p></dd>


<dt>show.prev</dt>
<dd><p>Logical, show prevalence value in the graph. Defaults to <code>TRUE</code>.</p></dd>


<dt>show.nonparam.pv</dt>
<dd><p>Logical, show non-parametric calculation of PVs. Defaults to <code>TRUE</code>.</p></dd>


<dt>show.best.pv</dt>
<dd><p>Logical, show best possible PVs. Defaults to <code>TRUE</code>.</p></dd>


<dt>include</dt>
<dd><p>Character vector (case-insensitive, partial matching) specifying what quantities
to include in the plot.</p>
<p>Default is: <code>c("PC", "PPV", "1-NPV")</code>.</p>
<p>Full options are: <code>c("NPV", "PC", "PPV", "1-NPV")</code>.</p></dd>


<dt>plot.raw</dt>
<dd><p>Logical to show percentiles or raw values.
Defaults to <code>FALSE</code> (i.e. percentiles).</p></dd>


<dt>rev.order</dt>
<dd><p>Logical, reverse ordering of scores. Defaults to <code>FALSE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list containing the plot and data, plus <code>errorbar</code> data if they were requested
(through <code>"binned"</code> estimation method with a parameter <code>errorbar.sem</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="estimation">Estimation<a class="anchor" aria-label="anchor" href="#estimation"></a></h2>
    

<p>The <code>methods</code> argument specifies the estimation method.
You can provide either a vector of strings, any of</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">c</span>(<span class="st">"asis"</span>, <span class="st">"binned"</span>, <span class="st">"pava"</span>, <span class="st">"mspline"</span>, <span class="st">"gam"</span>, <span class="st">"cgam"</span>)</span></code></pre><p></p></div>
<p>(<code>"asis"</code> is not available for <code>calibrationProfile</code>),
or a named list of lists.
In the latter case, the inner list must have an element "method",
which specifies the estimation function (one of those above),
and optionally other elements, which are passed to the estimation function.
For example:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">list</span>(</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="at">gam =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"gam"</span>, <span class="at">k =</span> <span class="dv">3</span>),</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="at">c_gam =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"cgam"</span>, <span class="at">numknots =</span> <span class="dv">3</span>)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>)</span></code></pre><p></p></div>
<p>To see what arguments are available for each estimation method,
see the documentation of that function.
The naming convention is <code>getXest</code>,
where <code>X</code> stands for the estimation method, for example <code><a href="getGAMest.html">getGAMest()</a></code>.</p>
<p>"gam", "cgam", and "mspline" always fit on percentiles by default.
To change this, use <code>fitonPerc = FALSE</code>, for example</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">list</span>(<span class="at">gam =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"gam"</span>, <span class="at">fitonPerc =</span> <span class="cn">FALSE</span>))</span></code></pre><p></p></div>
<p>"gam" and "cgam" methods are wrappers of <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">mgcv::gam()</a></code> and <code><a href="https://rdrr.io/pkg/cgam/man/cgam.html" class="external-link">cgam::cgam()</a></code>, respectively.
The default values of function arguments (like <code>k</code>, the number of knots in <code><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">mgcv::s()</a></code>)
mirror the package defaults.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="calibrationProfile.html">calibrationProfile()</a></code> <code><a href="sensSpec.html">sensSpec()</a></code></p>
<p><code><a href="getPAVAest.html">getPAVAest()</a></code> <code><a href="getBINNEDest.html">getBINNEDest()</a></code> <code><a href="getGAMest.html">getGAMest()</a></code> <code><a href="getCGAMest.html">getCGAMest()</a></code> <code><a href="getMSPLINEest.html">getMSPLINEest()</a></code>
<code><a href="getASISest.html">getASISest()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Read in example data</span></span></span>
<span class="r-in"><span><span class="va">auroc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"sample.csv"</span>, package <span class="op">=</span> <span class="st">"stats4phc"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rscore</span> <span class="op">&lt;-</span> <span class="va">auroc</span><span class="op">$</span><span class="va">predicted_calibrated</span></span></span>
<span class="r-in"><span><span class="va">truth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">auroc</span><span class="op">$</span><span class="va">actual</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Default plot includes 1-NPV, PPV, and a predictiveness curve (PC) based on risk-cutoff</span></span></span>
<span class="r-in"><span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu">riskProfile</span><span class="op">(</span>outcome <span class="op">=</span> <span class="va">truth</span>, score <span class="op">=</span> <span class="va">rscore</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p1</span><span class="op">$</span><span class="va">plot</span></span></span>
<span class="r-plt img"><img src="riskProfile-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">p1</span><span class="op">$</span><span class="va">data</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 3,006 × 7</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    method   score percentile outcome estimate pv    pvValue</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> asis   <span style="color: #BB0000;">NA</span>         0            <span style="color: #BB0000;">NA</span>   0.064<span style="text-decoration: underline;">0</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> asis    0.064<span style="text-decoration: underline;">0</span>    0.003<span style="text-decoration: underline;">00</span>       0   0.064<span style="text-decoration: underline;">0</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> asis    0.065<span style="text-decoration: underline;">4</span>    0.006<span style="text-decoration: underline;">01</span>       0   0.065<span style="text-decoration: underline;">4</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> asis    0.065<span style="text-decoration: underline;">9</span>    0.009<span style="text-decoration: underline;">01</span>       1   0.065<span style="text-decoration: underline;">9</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> asis    0.070<span style="text-decoration: underline;">2</span>    0.012<span style="text-decoration: underline;">0</span>        0   0.070<span style="text-decoration: underline;">2</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> asis    0.070<span style="text-decoration: underline;">9</span>    0.015<span style="text-decoration: underline;">0</span>        0   0.070<span style="text-decoration: underline;">9</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> asis    0.072<span style="text-decoration: underline;">1</span>    0.018<span style="text-decoration: underline;">0</span>        1   0.072<span style="text-decoration: underline;">1</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> asis    0.075<span style="text-decoration: underline;">3</span>    0.021<span style="text-decoration: underline;">0</span>        0   0.075<span style="text-decoration: underline;">3</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> asis    0.076<span style="text-decoration: underline;">4</span>    0.024<span style="text-decoration: underline;">0</span>        0   0.076<span style="text-decoration: underline;">4</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> asis    0.077<span style="text-decoration: underline;">0</span>    0.027<span style="text-decoration: underline;">0</span>        0   0.077<span style="text-decoration: underline;">0</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 2,996 more rows</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Show also NPV</span></span></span>
<span class="r-in"><span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu">riskProfile</span><span class="op">(</span></span></span>
<span class="r-in"><span>  outcome <span class="op">=</span> <span class="va">truth</span>,</span></span>
<span class="r-in"><span>  score <span class="op">=</span> <span class="va">rscore</span>,</span></span>
<span class="r-in"><span>  include <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PC"</span>, <span class="st">"NPV"</span>, <span class="st">"PPV"</span>, <span class="st">"1-NPV"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># or use partial matching: include = c("PC", "N", "PPV", "1")</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p2</span><span class="op">$</span><span class="va">plot</span></span></span>
<span class="r-plt img"><img src="riskProfile-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">p2</span><span class="op">$</span><span class="va">data</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 3,340 × 7</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    method   score percentile outcome estimate pv    pvValue</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span> asis   <span style="color: #BB0000;">NA</span>         0            <span style="color: #BB0000;">NA</span>   0.064<span style="text-decoration: underline;">0</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span> asis    0.064<span style="text-decoration: underline;">0</span>    0.003<span style="text-decoration: underline;">00</span>       0   0.064<span style="text-decoration: underline;">0</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span> asis    0.065<span style="text-decoration: underline;">4</span>    0.006<span style="text-decoration: underline;">01</span>       0   0.065<span style="text-decoration: underline;">4</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span> asis    0.065<span style="text-decoration: underline;">9</span>    0.009<span style="text-decoration: underline;">01</span>       1   0.065<span style="text-decoration: underline;">9</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span> asis    0.070<span style="text-decoration: underline;">2</span>    0.012<span style="text-decoration: underline;">0</span>        0   0.070<span style="text-decoration: underline;">2</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span> asis    0.070<span style="text-decoration: underline;">9</span>    0.015<span style="text-decoration: underline;">0</span>        0   0.070<span style="text-decoration: underline;">9</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span> asis    0.072<span style="text-decoration: underline;">1</span>    0.018<span style="text-decoration: underline;">0</span>        1   0.072<span style="text-decoration: underline;">1</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span> asis    0.075<span style="text-decoration: underline;">3</span>    0.021<span style="text-decoration: underline;">0</span>        0   0.075<span style="text-decoration: underline;">3</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span> asis    0.076<span style="text-decoration: underline;">4</span>    0.024<span style="text-decoration: underline;">0</span>        0   0.076<span style="text-decoration: underline;">4</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span> asis    0.077<span style="text-decoration: underline;">0</span>    0.027<span style="text-decoration: underline;">0</span>        0   0.077<span style="text-decoration: underline;">0</span> PC         <span style="color: #BB0000;">NA</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># ℹ 3,330 more rows</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># All estimates of prediction curve</span></span></span>
<span class="r-in"><span><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu">riskProfile</span><span class="op">(</span></span></span>
<span class="r-in"><span>  outcome <span class="op">=</span> <span class="va">truth</span>,</span></span>
<span class="r-in"><span>  score <span class="op">=</span> <span class="va">rscore</span>,</span></span>
<span class="r-in"><span>  methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mspline"</span>, <span class="st">"gam"</span>, <span class="st">"cgam"</span>, <span class="st">"binned"</span>, <span class="st">"pava"</span>, <span class="st">"asis"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  include <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PC"</span>, <span class="st">"PPV"</span>, <span class="st">"1-NPV"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p3</span><span class="op">$</span><span class="va">plot</span></span></span>
<span class="r-plt img"><img src="riskProfile-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Specifying method arguments (note each list has a "method" element)</span></span></span>
<span class="r-in"><span><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu">riskProfile</span><span class="op">(</span></span></span>
<span class="r-in"><span>  outcome <span class="op">=</span> <span class="va">truth</span>,</span></span>
<span class="r-in"><span>  score <span class="op">=</span> <span class="va">rscore</span>,</span></span>
<span class="r-in"><span>  methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"gam"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"gam"</span>, bs <span class="op">=</span> <span class="st">"tp"</span>, logscores <span class="op">=</span> <span class="cn">FALSE</span>, fitonPerc <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="st">"risk"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"asis"</span><span class="op">)</span>, <span class="co"># no available arguments for this method</span></span></span>
<span class="r-in"><span>    <span class="st">"bin"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"binned"</span>, quantiles <span class="op">=</span> <span class="fl">10</span>, errorbar.sem <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p4</span><span class="op">$</span><span class="va">plot</span></span></span>
<span class="r-plt img"><img src="riskProfile-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compare multiple GAMs in terms of Predictiveness Curves</span></span></span>
<span class="r-in"><span><span class="va">p5</span> <span class="op">&lt;-</span> <span class="fu">riskProfile</span><span class="op">(</span></span></span>
<span class="r-in"><span>  outcome <span class="op">=</span> <span class="va">truth</span>,</span></span>
<span class="r-in"><span>  score <span class="op">=</span> <span class="va">rscore</span>,</span></span>
<span class="r-in"><span>  methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"gam_3"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"gam"</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="st">"gam_4"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"gam"</span>, k <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="st">"gam_7"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"gam"</span>, k <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  include <span class="op">=</span> <span class="st">"PC"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p5</span><span class="op">$</span><span class="va">plot</span></span></span>
<span class="r-plt img"><img src="riskProfile-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using logistic regression as user-defined estimation function, fitting on percentiles</span></span></span>
<span class="r-in"><span><span class="co"># Function needs to take exactly these two arguments</span></span></span>
<span class="r-in"><span><span class="va">my_est</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">outcome</span>, <span class="va">score</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># Calculate percentiles</span></span></span>
<span class="r-in"><span>  <span class="va">perc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ecdf.html" class="external-link">ecdf</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span><span class="op">(</span><span class="va">score</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Fit</span></span></span>
<span class="r-in"><span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">perc</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Generate predictions</span></span></span>
<span class="r-in"><span>  <span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Return a data.frame with exactly these columns</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      score <span class="op">=</span> <span class="va">score</span>,</span></span>
<span class="r-in"><span>      percentile <span class="op">=</span> <span class="va">perc</span>,</span></span>
<span class="r-in"><span>      outcome <span class="op">=</span> <span class="va">outcome</span>,</span></span>
<span class="r-in"><span>      estimate <span class="op">=</span> <span class="va">preds</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">p6</span> <span class="op">&lt;-</span> <span class="fu">riskProfile</span><span class="op">(</span></span></span>
<span class="r-in"><span>  outcome <span class="op">=</span> <span class="va">truth</span>,</span></span>
<span class="r-in"><span>  score <span class="op">=</span> <span class="va">rscore</span>,</span></span>
<span class="r-in"><span>  methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>my_lr <span class="op">=</span> <span class="va">my_est</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p6</span><span class="op">$</span><span class="va">plot</span></span></span>
<span class="r-plt img"><img src="riskProfile-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using cgam as user-defined estimation function</span></span></span>
<span class="r-in"><span><span class="co"># Note that you can also use the predefined cgam using methods = "cgam"</span></span></span>
<span class="r-in"><span><span class="co"># Attach needed library</span></span></span>
<span class="r-in"><span><span class="co"># Watch out for masking of mgcv::s and cgam::s if both are attached</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">cgam</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘cgam’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:coneproj’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     conc, conv, decr, decr.conc, decr.conv, incr, incr.conc, incr.conv</span>
<span class="r-in"><span><span class="co"># Function needs to take exactly these two arguments</span></span></span>
<span class="r-in"><span><span class="va">my_est</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">outcome</span>, <span class="va">score</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># Fit on raw predictions with space = "E"</span></span></span>
<span class="r-in"><span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/cgam/man/cgam.html" class="external-link">cgam</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">outcome</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/cgam/man/s.incr.html" class="external-link">s.incr</a></span><span class="op">(</span><span class="va">score</span>, numknots <span class="op">=</span> <span class="fl">5</span>, space <span class="op">=</span> <span class="st">"E"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    family <span class="op">=</span> <span class="st">"binomial"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Generate predictions and convert to vector</span></span></span>
<span class="r-in"><span>  <span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">$</span><span class="va">fit</span></span></span>
<span class="r-in"><span>  <span class="co"># Return a data.frame with exactly these columns</span></span></span>
<span class="r-in"><span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    score <span class="op">=</span> <span class="va">score</span>,</span></span>
<span class="r-in"><span>    percentile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ecdf.html" class="external-link">ecdf</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span><span class="op">(</span><span class="va">score</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    outcome <span class="op">=</span> <span class="va">outcome</span>,</span></span>
<span class="r-in"><span>    estimate <span class="op">=</span> <span class="va">preds</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">p7</span> <span class="op">&lt;-</span> <span class="fu">riskProfile</span><span class="op">(</span></span></span>
<span class="r-in"><span>  outcome <span class="op">=</span> <span class="va">truth</span>,</span></span>
<span class="r-in"><span>  score <span class="op">=</span> <span class="va">rscore</span>,</span></span>
<span class="r-in"><span>  methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>my_cgam <span class="op">=</span> <span class="va">my_est</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p7</span><span class="op">$</span><span class="va">plot</span></span></span>
<span class="r-plt img"><img src="riskProfile-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Prevalence adjustment to 0.1</span></span></span>
<span class="r-in"><span><span class="va">p8</span> <span class="op">&lt;-</span> <span class="fu">riskProfile</span><span class="op">(</span>outcome <span class="op">=</span> <span class="va">truth</span>, score <span class="op">=</span> <span class="va">rscore</span>, prev.adj <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">p8</span><span class="op">$</span><span class="va">plot</span></span></span>
<span class="r-plt img"><img src="riskProfile-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Ondrej Slama, Darrick Shen, Verena Steffen, Michel Friesenhahn, Christina Rabe, F. Hoffmann-La Roche AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

