<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="stats4phc">
<title>stats4phc • stats4phc</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="stats4phc">
<meta property="og:description" content="stats4phc">
<meta property="og:image" content="https://genentech.github.io/stats4phc/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">stats4phc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/stats4phc.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-reports">Reports</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-reports">
    <a class="dropdown-item" href="../../coverage-report/">Coverage report</a>
    <a class="dropdown-item" href="../../unit-test-report/">Unit test report</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.github.com/genentech/stats4phc">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>stats4phc</h1>
            
      
      
      <div class="d-none name"><code>stats4phc.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction-to-stats4phc">Introduction to stats4phc<a class="anchor" aria-label="anchor" href="#introduction-to-stats4phc"></a>
</h2>
<p>This package provides functions for performance evaluation for the
prognostic value of predictive models when the outcomes of interest are
binary. We will describe 3 aspects that support such a performance
evaluation:</p>
<ul>
<li>Predictiveness curves</li>
<li>Calibration</li>
<li>Sensitivity and specificity</li>
</ul>
<p>The intention is not to replace standard metrics evaluation (like
Brier score, log-loss, or AUC). On the contrary, the mentioned
quantities should be checked in addition in order to get the overall
sense of model behaviour.</p>
<div class="section level3">
<h3 id="terminology">Terminology<a class="anchor" aria-label="anchor" href="#terminology"></a>
</h3>
<p>To begin with, let’s align on terminology. Below we define the terms
that will be used across the article:</p>
<ul>
<li><p>outcome: the true observation of the quantity of
interest;</p></li>
<li>
<p>score / risk:</p>
<ul>
<li><p>either a raw value (e.g. a biomarker) for the purpose of
measuring (or approximating) the outcome,</p></li>
<li><p>or a probability given by a predictive model, where the outcome
was modeled as the response;</p></li>
</ul>
</li>
<li><p>estimate: output of a statistical methodology, where score is
used as independent variable and outcome as a dependent
variable.</p></li>
</ul>
<p>Let’s now load the package and the example data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://genentech.github.io/stats4phc">stats4phc</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read in example data</span></span>
<span><span class="va">auroc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"sample.csv"</span>, package <span class="op">=</span> <span class="st">"stats4phc"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rscore</span> <span class="op">&lt;-</span> <span class="va">auroc</span><span class="op">$</span><span class="va">predicted_calibrated</span>  <span class="co"># vector of already calibrated model probabilities</span></span>
<span><span class="va">truth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">auroc</span><span class="op">$</span><span class="va">actual</span><span class="op">)</span>     <span class="co"># vector of 0s or 1s</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="predictiveness-curves">Predictiveness curves<a class="anchor" aria-label="anchor" href="#predictiveness-curves"></a>
</h2>
<p>Predictiveness curves are an insightful visualization to assess the
inherent ability of prognostic models to provide predictions to
individual patients. Cumulative versions of predictiveness curves
represent positive predictive values (PPV) and 1 - negative predictive
values (1 - NPV) and are also informative if the eventual goal is to use
a cutoff for clinical decision making.</p>
<p>You can use <code>riskProfile</code> function to visualize and assess
all these quantities.</p>
<p>Note that method “asis” (below on the graphs) means that the score
(or model probabilities in our case) are taken as is, i.e. there is no
estimation or smoothing.</p>
<div class="section level3">
<h3 id="predictiveness-curve">Predictiveness curve<a class="anchor" aria-label="anchor" href="#predictiveness-curve"></a>
</h3>
<p>Let’s start with predictiveness curve:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/riskProfile.html">riskProfile</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="va">truth</span>, score <span class="op">=</span> <span class="va">rscore</span>, include <span class="op">=</span> <span class="st">"PC"</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<p><img src="stats4phc_files/figure-html/unnamed-chunk-2-1.png" width="768"></p>
<p>Ideally, all subjects in the population that have the condition
(=&gt; prevalence) are marked as having the condition (predicted risk =
1) and all subjects without the condition (=&gt; 1 - prevalence) are
marked as not having the condition (predicted risk = 0). This implies
that the ideal predictiveness curve is 0 for all subjects not having the
condition, and then it steps (jumps) at <code>1 - prevalence</code> to 1
for all the subjects having the condition (see the gray line).</p>
<p>In reality, the curves are not step functions. The more flat the
curves get, the less discrimination, and therefore utility, there is in
the model.</p>
<p>One can also investigate the tails of predictiveness curve. The model
is more useful if these regions have very low or very high predicted
risks relatively to the rest of the data.</p>
</div>
<div class="section level3">
<h3 id="positive-negative-predictive-values">Positive / Negative predictive values<a class="anchor" aria-label="anchor" href="#positive-negative-predictive-values"></a>
</h3>
<p>Now let’s plot PPV and 1-NPV:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/riskProfile.html">riskProfile</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="va">truth</span>, score <span class="op">=</span> <span class="va">rscore</span>, include <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PPV"</span>, <span class="st">"1-NPV"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<p><img src="stats4phc_files/figure-html/unnamed-chunk-3-1.png" width="768"></p>
<p>Again, in an ideal case, they both are as close to the gray lines as
possible.</p>
<p>In an ideal scenario:</p>
<ul>
<li><p>in terms of PPV: If all the subjects with the condition are
predicted perfectly, then PPV = TP / PP = 1 (TP = true positive, PP =
predicted positive). Hence, all the subjects with the condition must be
higher than <code>1 - prevalence</code> on the prediction percentile for
PPV = 1.</p></li>
<li><p>in terms of 1-NPV: If all the subjects without the condition are
predicted perfectly, then NPV = TN / PN = 1 (TN = true negative, PN =
predicted negative). Hence, all the subjects without the condition must
be lower than <code>1 - prevalence</code> on the risk percentile for
1-NPV = 0.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="output-settings">Output settings<a class="anchor" aria-label="anchor" href="#output-settings"></a>
</h3>
<p>Note that:</p>
<ul>
<li><p>most importantly, in case of a biomarker or if the model
probabilities are not calibrated well, you can use a smoother, see
<code>methods</code> argument and the last section of the
vignette.</p></li>
<li><p>the prevalence can be adjusted by setting it in
<code>prev.adj</code>.</p></li>
<li><p>you can also plot “NPV” by adjusting the <code>include</code>
parameter.</p></li>
<li><p>you can also access the underlying data:</p></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/riskProfile.html">riskProfile</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="va">truth</span>, score <span class="op">=</span> <span class="va">rscore</span>, include <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PPV"</span>, <span class="st">"1-NPV"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">p</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">##   method pv    percentile   score estimate outcome pvValue</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> asis   NPV      0       <span style="color: #BB0000;">NA</span>       <span style="color: #BB0000;">NA</span>           <span style="color: #BB0000;">NA</span>   1    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> asis   NPV      0.003<span style="text-decoration: underline;">00</span>  0.064<span style="text-decoration: underline;">0</span>   0.064<span style="text-decoration: underline;">0</span>       0   1    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> asis   NPV      0.006<span style="text-decoration: underline;">01</span>  0.065<span style="text-decoration: underline;">4</span>   0.065<span style="text-decoration: underline;">4</span>       0   0.968</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> asis   NPV      0.009<span style="text-decoration: underline;">01</span>  0.065<span style="text-decoration: underline;">9</span>   0.065<span style="text-decoration: underline;">9</span>       1   0.957</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> asis   NPV      0.012<span style="text-decoration: underline;">0</span>   0.070<span style="text-decoration: underline;">2</span>   0.070<span style="text-decoration: underline;">2</span>       0   0.950</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> asis   NPV      0.015<span style="text-decoration: underline;">0</span>   0.070<span style="text-decoration: underline;">9</span>   0.070<span style="text-decoration: underline;">9</span>       0   0.946</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="calibration">Calibration<a class="anchor" aria-label="anchor" href="#calibration"></a>
</h2>
<p>Calibration is the assessment of systematic bias in a score.
Visually, when plotting score on the x-axis vs. outcomes on the y-axis,
the model is calibrated if points are centered around the identity line.
If it is not the case, we talk about miscalibration (see <a href="https://stats-4-datascience.github.io/blog/posts/three_metrics/#calibration" class="external-link">reference</a>).
By improving calibration, one can improve the performance of the
model.</p>
<p>You can use <code>calibrationProfile</code> function to visualize and
assess calibration.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calibrationProfile.html">calibrationProfile</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="va">truth</span>, score <span class="op">=</span> <span class="va">rscore</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<p><img src="stats4phc_files/figure-html/unnamed-chunk-5-1.png" width="768"></p>
<p>In an ideal scenario, the fitted curves should be identical with the
identity line.</p>
<p>In reality, the closer they are to the identity line, the better.</p>
<p>Note that you can also quantify calibration through discrimination
and miscalibration index, see this <a href="https://stats4datascience.com/posts/three_metrics_binary/" class="external-link">blog
post</a> and <a href="https://github.com/Genentech/modsculpt" class="external-link">modsculpt</a> R package
(metrics functions).</p>
<div class="section level3">
<h3 id="output-settings-1">Output settings<a class="anchor" aria-label="anchor" href="#output-settings-1"></a>
</h3>
<p>Note that:</p>
<ul>
<li><p>in case of a biomarker or if the model probabilities are not
calibrated well, you can use a smoother, see <code>methods</code>
argument and the last section of the vignette. In this case,
<code>"asis"</code> is not allowed.</p></li>
<li>
<p>use <code>include</code> argument to specify what additional
quantities to show:</p>
<ul>
<li><p><code>"loess"</code>: Adds non-parametric Loess fit.</p></li>
<li><p><code>"citl"</code>: Adds “Calibration in the Large”, an overall
mean of outcome and score.</p></li>
<li><p><code>"rug"</code>: Adds “rug”, i.e. ticks on x-axis showing the
individual data points (top axis shows score for outcome == 1, bottom
axis shows score for outcome == 0).</p></li>
<li><p><code>"datapoints"</code>: Similar to rug, just shows jittered
points instead of ticks.</p></li>
</ul>
</li>
<li><p>use <code>margin.type</code> to add a marginal plot through
<code><a href="https://rdrr.io/pkg/ggExtra/man/ggMarginal.html" class="external-link">ggExtra::ggMarginal</a></code>. You can select one of
<code>c("density", "histogram", "boxplot", "violin", "densigram")</code>.
It adds the selected 1d graph on top of the calibrtion plot and is
suitable for investigating the score.</p></li>
<li><p>you can again access the underlying data with
<code>p$data</code>.</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="sensitivity-and-specificity">Sensitivity and specificity<a class="anchor" aria-label="anchor" href="#sensitivity-and-specificity"></a>
</h2>
<p>Ultimately, we provide a sensitivity and specificity plot as a
function of score (threshold is data-driven). This graph may inform you
of the best suitable cutoff for your model, although we usually
recommend to output the whole score range, not just the binary
decisions.</p>
<p>You can use <code>sensSpec</code> function to visualize and assess
sensitivity and specificity.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sensSpec.html">sensSpec</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="va">truth</span>, score <span class="op">=</span> <span class="va">rscore</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<p><img src="stats4phc_files/figure-html/unnamed-chunk-6-1.png" width="768"></p>
<p>Again, the ideal scenario would be having a model following the gray
lines. Since there is a trade-off between sensitivity and specificity,
the graph may guide you which threshold (or thresholds) to choose,
depending if one is more important than the other.</p>
<div class="section level3">
<h3 id="output-settings-2">Output settings<a class="anchor" aria-label="anchor" href="#output-settings-2"></a>
</h3>
<p>Note that:</p>
<ul>
<li><p>in case of a biomarker or if the model probabilities are not
calibrated well, you can use a smoother, see <code>methods</code>
argument and the last section of the vignette.</p></li>
<li><p>you can again access the underlying data with
<code>p$data</code>.</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="adjusting-the-graphs">Adjusting the graphs<a class="anchor" aria-label="anchor" href="#adjusting-the-graphs"></a>
</h2>
<p>All the functions return the ggplot object under the
<code>$plot</code> element so you can further adjust it by adding more
layers. There is a risk that you might overwrite one of the previous
layers, so please double check your results.</p>
<p>For example, if you want to use the following graph</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/riskProfile.html">riskProfile</a></span><span class="op">(</span></span>
<span>  outcome <span class="op">=</span> <span class="va">truth</span>, </span>
<span>  score <span class="op">=</span> <span class="va">rscore</span>, </span>
<span>  methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"asis"</span>, <span class="st">"gam"</span><span class="op">)</span>, </span>
<span>  include <span class="op">=</span> <span class="st">"PC"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">plot</span></span></code></pre></div>
<p><img src="stats4phc_files/figure-html/unnamed-chunk-7-1.png" width="614.4"></p>
<p>for your publication with some minor adjustments, here is how you can
change colours and line types:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">$</span><span class="va">plot</span> <span class="op">+</span> </span>
<span>  <span class="co"># change the colours to blue for "gam" and darkgreen for "asis"</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gam"</span> <span class="op">=</span> <span class="st">"blue"</span>, <span class="st">"asis"</span> <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># change the linetypes to solid for both</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gam"</span> <span class="op">=</span> <span class="st">"solid"</span>, <span class="st">"asis"</span> <span class="op">=</span> <span class="st">"solid"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Scale for <span style="color: #00BB00;">colour</span> is already present.</span></span>
<span><span class="co">## Adding another scale for <span style="color: #00BB00;">colour</span>, which will replace the existing scale.</span></span></code></pre>
<p><img src="stats4phc_files/figure-html/unnamed-chunk-8-1.png" width="614.4"></p>
<p>Otherwise, you can use the <code>$data</code> element to construct
your own graph as well.</p>
</div>
<div class="section level2">
<h2 id="estimations-in-stats4phc">Estimations in stats4phc<a class="anchor" aria-label="anchor" href="#estimations-in-stats4phc"></a>
</h2>
<p>For all the plotting functions from this package, there is a
possibility to define an estimation function, which will be applied on
the given score. In <code>calibrationProfile</code>, this serves as a
calibration curve. In <code>riskProfile</code>, this smooths the given
score. All of this is always driven by the <code>methods</code>
argument, which is available in each of the plotting functions.</p>
<p>There are couple of predefined estimation methods:</p>
<pre><code><span><span class="co">## [1] "asis"    "binned"  "cgam"    "gam"     "mspline" "pava"</span></span></code></pre>
<p>Users can also define their own estimation function if needed.</p>
<div class="section level3">
<h3 id="predefined-estimation-functions">Predefined estimation functions<a class="anchor" aria-label="anchor" href="#predefined-estimation-functions"></a>
</h3>
<p>The predefined estimation functions can be given as a character, in
which case the default values of the estimation function arguments will
be used, or as a list, in which case you can change the parameters of
the estimation.</p>
<p>The character vector approach, using the default parameter values, is
as follows:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">methods</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gam"</span>, <span class="st">"cgam"</span><span class="op">)</span></span></code></pre></div>
<p>To see the possible arguments and their defaults, look into the
estimation function documentation, which is always available as
<code>getXest</code>, where <code>X</code> stands for the estimation
function (e.g. <code>getCGAMest</code>). Here is the list of all:</p>
<pre><code><span><span class="co">## [1] "getASISest"    "getBINNEDest"  "getCGAMest"    "getGAMest"    </span></span>
<span><span class="co">## [5] "getMSPLINEest" "getPAVAest"</span></span></code></pre>
<p>For example, by running <code><a href="../reference/getGAMest.html">?getGAMest</a></code>, we see that
<code>"gam"</code> sets <code>k</code>, the number of knots, to
<code>-1</code>, which refers to automatic selection.</p>
<p>Otherwise, you can specify the estimation methods as a list, in which
case you can change the argument values, e.g.:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">methods</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  gam3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"gam"</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  gam5 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"gam"</span>, k <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  cgam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cgam"</span>, numknots <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="co"># automatic knot selection</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that all the list elements must be (uniquely) named, both inner
and outer lists, and there <strong>always</strong> needs to be an
element <code>"method"</code>, which specifies the estimation
function.</p>
<p>By default, <code>"gam"</code>, <code>"cgam"</code>, and
<code>"mspline"</code> always fit on percentiles. If you want to change
this, you need to specify it through an argument <code>fitonPerc</code>,
such as:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">methods</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mspline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"mspline"</span>, fitonPerc <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Finally, method <code>"asis"</code> is a specific “estimation
method”, which takes the input “as is”, it does not perform any
estimation. It is listed here for consistency. You can use this method
in case you want to assess your score without any adjustments.</p>
</div>
<div class="section level3">
<h3 id="user-defined-estimation-functions">User-defined estimation functions<a class="anchor" aria-label="anchor" href="#user-defined-estimation-functions"></a>
</h3>
<p>You can also define your own estimation function. To do so, define a
function which:</p>
<ul>
<li><p>takes exactly these 2 arguments: <code>outcome</code> and
<code>score</code>.</p></li>
<li><p>performs the estimation of your choice, based on
<code>outcome</code> and <code>score</code>.</p></li>
<li><p>returns a <code>data.frame</code> of exactly these 4 columns:
<code>score</code>, <code>percentile</code> (percentile of
<code>score</code>), <code>outcome</code>, and <code>estimate</code>
(result of your estimation).</p></li>
</ul>
<p>Here is an example:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># User-defined estimation function - logistic regression</span></span>
<span></span>
<span><span class="co"># Function needs to take exactly these two arguments</span></span>
<span><span class="va">my_logistic</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">outcome</span>, <span class="va">score</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Calculate percentiles</span></span>
<span>  <span class="va">perc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/ecdf.html" class="external-link">ecdf</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span><span class="op">(</span><span class="va">score</span><span class="op">)</span></span>
<span>  <span class="co"># Fit logistic regression on percentiles</span></span>
<span>  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">~</span> <span class="va">perc</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span>
<span>  <span class="co"># Generate predictions</span></span>
<span>  <span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">m</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span>  <span class="co"># Return a data.frame with these 4 columns</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      score <span class="op">=</span> <span class="va">score</span>,</span>
<span>      percentile <span class="op">=</span> <span class="va">perc</span>,</span>
<span>      outcome <span class="op">=</span> <span class="va">outcome</span>,</span>
<span>      estimate <span class="op">=</span> <span class="va">preds</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Then provide it to the `methods` argument as a named list</span></span>
<span><span class="va">methods</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>my_logistic <span class="op">=</span> <span class="va">my_logistic</span><span class="op">)</span></span></code></pre></div>
<p>Note that you can also combine user-defined functions with already
predefined functions, e.g.:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">methods</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>my_logistic <span class="op">=</span> <span class="va">my_logistic</span>, gam <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"gam"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Hint: if you cannot get your function to work correctly, use
<code><a href="https://rdrr.io/r/base/browser.html" class="external-link">browser()</a></code> in your function to interactively debug it in
order to see what’s wrong.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ondrej Slama, Darrick Shen, Verena Steffen, Doug Kelkhoff, Michel Friesenhahn, Christina Rabe, F. Hoffmann-La Roche AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
